?<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Listening: Simulador con Temporizador y Canvas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sticky-audio { position: sticky; top: 0; z-index: 100; background: #ffffff; border-bottom: 3px solid #1d4ed8; }
        .canvas-area { border: 2px solid #e2e8f0; background-color: #f8fafc; cursor: url('https://img.icons8.com/ios-filled/20/000000/pencil.png'), auto; }
        .input-line { border-bottom: 2px solid #94a3b8; outline: none; transition: all 0.2s; }
        .input-line:focus { border-color: #2563eb; background: #f0f9ff; }
        .timer-warning { color: #dc2626; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
<div style="position:fixed;top:20px;left:20px;z-index:9999" class="no-print"><a href="/resources.html" style="display:inline-flex;align-items:center;gap:8px;padding:10px 16px;background:#6366f1;color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.15);transition:all 0.2s" onmouseover="this.style.background='#4f46e5'" onmouseout="this.style.background='#6366f1'"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Resources</a></div>


    <div class="sticky-audio shadow-md p-4">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 items-center gap-4">
            <div>
                <h1 class="text-xl font-black text-blue-900 uppercase">Comprensión Auditiva</h1>
                <p id="timerDisplay" class="text-2xl font-mono font-bold text-slate-700">15:00</p>
            </div>
            <div class="bg-slate-100 p-3 rounded-xl">
                <audio id="examAudio" controls class="w-full">
                    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" type="audio/mpeg">
                </audio>
            </div>
            <div class="text-right">
                <button onclick="startExam()" id="startBtn" class="bg-green-600 text-white px-6 py-2 rounded-full font-bold hover:bg-green-700 transition">EMPEZAR EXAMEN</button>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-8 space-y-8">
            <form id="listeningForm">
                
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold text-blue-800 mb-6 flex items-center">
                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-lg mr-3 text-sm">TEXTO A</span>
                        Entrevista: La cocina fusión de Diego
                    </h2>
                    
                    <div class="space-y-6">
                        <div class="p-4 bg-slate-50 rounded-xl">
                            <p class="font-bold mb-3">1. Diego aprendió a cocinar gracias a su...</p>
                            <div class="flex space-x-6">
                                <label><input type="radio" name="q1" value="A" class="mr-2"> A. Abuela</label>
                                <label><input type="radio" name="q1" value="B" class="mr-2"> B. Padre</label>
                                <label><input type="radio" name="q1" value="C" class="mr-2"> C. Profesor</label>
                            </div>
                        </div>

                        <div class="p-4">
                            <p class="font-bold mb-3">2. Completa la frase sobre su restaurante:</p>
                            <p class="text-lg">"El restaurante abre sus puertas a las <input type="text" id="ans_time" class="input-line w-24 text-center" placeholder="..."> de la tarde y ofrece platos de tres <input type="text" id="ans_cont" class="input-line w-40 text-center" placeholder="..."> diferentes."</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold text-orange-700 mb-6 flex items-center">
                        <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-lg mr-3 text-sm">TEXTO B</span>
                        Anuncio: Fiestas del Sol en Colombia
                    </h2>
                    
                    <p class="mb-4 font-bold italic">3. Indica si las siguientes afirmaciones son Verdaderas (V) o Falsas (F):</p>
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-50">
                                <th class="p-3 border">Afirmación</th>
                                <th class="p-3 border text-center">V</th>
                                <th class="p-3 border text-center">F</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="p-3 border">Las entradas son gratuitas para niños.</td>
                                <td class="p-3 border text-center"><input type="radio" name="v1" value="V"></td>
                                <td class="p-3 border text-center"><input type="radio" name="v1" value="F"></td>
                            </tr>
                            <tr>
                                <td class="p-3 border">Se recomienda llevar ropa elegante.</td>
                                <td class="p-3 border text-center"><input type="radio" name="v2" value="V"></td>
                                <td class="p-3 border text-center"><input type="radio" name="v2" value="F"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="py-10">
                    <button type="button" onclick="gradeListening()" class="w-full bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl hover:bg-blue-800 transition">ENTREGAR PRUEBA</button>
                </div>
            </form>
        </div>

        <div class="lg:col-span-4">
            <div class="sticky top-24 space-y-6">
                <div class="bg-white p-6 rounded-3xl shadow-md border border-slate-200">
                    <h3 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest">Borrador de Notas</h3>
                    <canvas id="examCanvas" width="350" height="450" class="canvas-area w-full rounded-2xl shadow-inner"></canvas>
                    <div class="flex gap-2 mt-4">
                        <button onclick="clearCanvas()" class="flex-1 text-xs font-bold border py-2 rounded-xl hover:bg-slate-50 text-slate-500">Limpiar</button>
                        <button onclick="ctx.strokeStyle = '#2563eb'" class="w-8 h-8 rounded-full bg-blue-600 border-4 border-white shadow"></button>
                        <button onclick="ctx.strokeStyle = '#dc2626'" class="w-8 h-8 rounded-full bg-red-600 border-4 border-white shadow"></button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // TEMPORIZADOR
        let timeLeft = 900; // 15 minutos
        let timerInterval;

        function startExam() {
            if (timerInterval) return;
            document.getElementById('examAudio').play();
            document.getElementById('startBtn').disabled = true;
            document.getElementById('startBtn').classList.add('opacity-50');
            
            timerInterval = setInterval(() => {
                timeLeft--;
                let mins = Math.floor(timeLeft / 60);
                let secs = timeLeft % 60;
                document.getElementById('timerDisplay').innerText = 
                    `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                
                if (timeLeft < 60) document.getElementById('timerDisplay').classList.add('timer-warning');
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    gradeListening();
                    alert("¡Tiempo agotado!");
                }
            }, 1000);
        }

        // CANVAS DE NOTAS
        const canvas = document.getElementById('examCanvas');
        const ctx = canvas.getContext('2d');
        let painting = false;

        function startDraw(e) { painting = true; draw(e); }
        function endDraw() { painting = false; ctx.beginPath(); }
        function draw(e) {
            if (!painting) return;
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('mousemove', draw);
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        // CALIFICACIÓN
        function gradeListening() {
            clearInterval(timerInterval);
            let score = 0;
            const f = document.forms['listeningForm'];

            if(f.l1.checked && f.l1.value === 'A') score++; // Abuela
            if(document.getElementById('ans_time').value.includes('7')) score++;
            if(document.getElementById('ans_cont').value.toLowerCase().includes('continentes')) score++;
            if(f.v1.value === 'V') score++;
            if(f.v2.value === 'F') score++;

            alert(`Examen finalizado.\nPuntuación estimada: ${score} / 5\n¡Revisa tus respuestas con el audio!`);
        }
    </script>
</body>
</html>





