<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misión Dirección - Navegación</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f1f5f9;
            color: #1e293b;
        }

        .city-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 12px;
            background-color: #94a3b8;
            padding: 15px;
            border-radius: 28px;
            aspect-ratio: 1 / 1;
            box-shadow: inset 0 2px 15px rgba(0,0,0,0.1);
        }

        .tile {
            background-color: #f8fafc;
            border-radius: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            position: relative;
            text-align: center;
            transition: all 0.3s ease;
            border-bottom: 4px solid #e2e8f0;
        }

        /* Calles */
        .tile.road {
            background-color: #334155;
            border-bottom: none;
            border: 1px dashed rgba(255,255,255,0.1);
        }

        /* El Personaje */
        .tile.player::before {
            content: '';
            position: absolute;
            font-size: 2.2rem;
            top: -18px;
            z-index: 100;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
            animation: float 0.8s infinite alternate ease-in-out;
        }

        @keyframes float {
            from { transform: translateY(0); }
            to { transform: translateY(-8px); }
        }

        /* Edificio de Inicio y Fin */
        .tile.start-point {
            border: 4px solid #fbbf24;
            background-color: #fffbeb;
        }

        .tile.target-glow {
            border: 4px solid #0ea5e9;
            background-color: #f0f9ff;
            animation: pulse-blue 2s infinite;
        }

        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(14, 165, 233, 0); }
            100% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0); }
        }

        /* Marcadores de Puerta/Salida */
        .tile.exit-door::after {
            content: '🚪 SALIDA';
            position: absolute;
            font-size: 8px;
            bottom: 4px;
            background: #10b981;
            color: white;
            padding: 2px 5px;
            border-radius: 4px;
            font-weight: 900;
            animation: bounce-small 1s infinite;
        }

        @keyframes bounce-small {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .dir-btn {
            background-color: #ffffff;
            border: 2px solid #e2e8f0;
            transition: all 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: #475569;
            box-shadow: 0 4px 0 #e2e8f0;
        }

        .dir-btn:hover { border-color: #0ea5e9; color: #0ea5e9; }
        .dir-btn:active { transform: translateY(3px); box-shadow: none; }

        .option-btn {
            @apply p-4 rounded-2xl border-2 border-slate-100 hover:border-sky-400 hover:bg-sky-50 text-left font-bold transition-all text-slate-700 flex flex-col items-start gap-1 w-full shadow-sm;
        }

        .hidden-panel { display: none; }
        
        .status-tag {
            @apply absolute top-1 px-2 py-0.5 rounded text-[7px] font-black uppercase tracking-tighter;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 p-4 md:p-8">
<div style="position:fixed;top:20px;left:20px;z-index:9999" class="no-print"><a href="../index.html" style="display:inline-flex;align-items:center;gap:8px;padding:10px 16px;background:#6366f1;color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.15);transition:all 0.2s" onmouseover="this.style.background='#4f46e5'" onmouseout="this.style.background='#6366f1'"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Resources</a></div>
    <!-- Back Button -->
    

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-6">
            <div>
                <h1 class="text-5xl font-black text-slate-800 uppercase tracking-tighter italic">Ruta <span class="text-sky-500">Real</span></h1>
                <p class="text-slate-500 font-medium">Sal del edificio, cruza la calle y llega a tu destino.</p>
            </div>
            <div class="bg-white px-8 py-3 rounded-3xl shadow-sm border border-slate-200 text-center">
                <p class="text-xs font-bold text-slate-400 uppercase">Puntos acumulados</p>
                <p id="score" class="text-3xl font-black text-sky-500">0</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            
            <!-- El Mapa -->
            <div class="bg-white p-6 rounded-[40px] shadow-2xl border border-slate-200">
                <div id="city-map" class="city-grid"></div>
                <div class="mt-6 flex gap-4">
                    <div class="flex-1 p-4 bg-amber-50 rounded-2xl border border-amber-100 flex items-center gap-3">
                        <span class="text-2xl">🏨</span>
                        <p class="text-xs text-amber-800 font-bold italic">Estás ADENTRO. Busca la flecha verde en la calle para salir.</p>
                    </div>
                </div>
            </div>

            <!-- Controles y Misiones -->
            <div class="flex flex-col gap-6">
                
                <!-- Misión -->
                <div class="bg-white p-6 rounded-3xl shadow-md border-l-[10px] border-rose-500">
                    <h2 class="text-xs font-black text-rose-500 uppercase mb-1 tracking-widest">Tu objetivo actual:</h2>
                    <p id="mission-text" class="text-2xl font-bold text-slate-800 leading-tight">Cargando misión...</p>
                </div>

                <!-- Panel Navegación -->
                <div id="navigation-panel" class="bg-white p-8 rounded-[40px] border border-slate-200 shadow-sm">
                    <div class="grid grid-cols-3 gap-3 max-w-[400px] mx-auto">
                        <div></div>
                        <button onclick="movePlayer('up')" class="dir-btn p-4 rounded-2xl h-24 text-[10px]">
                            <i class="fa-solid fa-arrow-up text-2xl mb-1"></i>
                            SIGUE RECTO
                        </button>
                        <div></div>
                        
                        <button onclick="movePlayer('left')" class="dir-btn p-4 rounded-2xl h-24 text-[10px]">
                            <i class="fa-solid fa-arrow-left text-2xl mb-1"></i>
                            GIRA IZQUIERDA
                        </button>
                        <button onclick="movePlayer('cross')" class="dir-btn p-4 rounded-2xl h-24 text-[10px] border-emerald-300 bg-emerald-50 text-emerald-700 shadow-emerald-200">
                            <i class="fa-solid fa-person-walking-arrow-right text-2xl mb-1"></i>
                            CRUZA LA CALLE
                        </button>
                        <button onclick="movePlayer('right')" class="dir-btn p-4 rounded-2xl h-24 text-[10px]">
                            <i class="fa-solid fa-arrow-right text-2xl mb-1"></i>
                            GIRA DERECHA
                        </button>
                        
                        <div class="flex items-center justify-center">
                            <p class="text-[8px] text-slate-400 font-bold text-center italic">Usa las flechas del teclado también</p>
                        </div>
                        <button onclick="movePlayer('down')" class="dir-btn p-4 rounded-2xl h-24 text-[10px]">
                            <i class="fa-solid fa-arrow-down text-2xl mb-1"></i>
                            VE ATRÁS
                        </button>
                        <button onclick="checkArrival()" class="bg-sky-500 text-white rounded-2xl font-black text-xs uppercase shadow-lg shadow-sky-200 hover:bg-sky-600 transition flex flex-col items-center justify-center">
                            <i class="fa-solid fa-door-open mb-1"></i>
                            ENTRAR
                        </button>
                    </div>
                    <p id="error-msg" class="text-center text-rose-500 text-xs mt-6 font-bold h-4 uppercase"></p>
                </div>

                <!-- Panel de Pregunta (Se activa al entrar) -->
                <div id="validation-panel" class="hidden-panel bg-white p-8 rounded-[40px] border-4 border-emerald-400 shadow-2xl">
                    <h3 class="font-black text-slate-800 uppercase tracking-tighter mb-4 text-2xl text-center">¡Bienvenido!</h3>
                    <p class="text-slate-500 mb-6 text-center font-medium italic text-lg leading-snug">"Perdone, acabo de verle llegar... <br> ¿Cómo ha venido desde <span id="start-node-name" class="text-rose-500 underline">...</span>?"</p>
                    <div id="answer-options" class="flex flex-col gap-3"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const svgs = {
            museo: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 22h20M4 22V10l8-6 8 6v12M8 22v-9h8v9"/><path d="M12 7v3"/></svg>`,
            hospital: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/><path d="M12 7v10M8 12h8"/></svg>`,
            banco: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M3 10h18M5 10v11M9 10v11M15 10v11M19 10v11M12 2 3 7h18L12 2z"/></svg>`,
            escuela: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>`,
            plaza: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>`,
            super: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>`,
            cine: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2"/><path d="M7 2v20M17 2v20M2 12h20"/></svg>`,
            biblioteca: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15"/></svg>`,
            estacion: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="3" width="16" height="15" rx="2"/><path d="M4 11h16M12 3v15"/></svg>`
        };

        const cityData = [
            { id: 0, type: 'building', name: 'Museo', svg: svgs.museo }, { id: 1, type: 'road' }, { id: 2, type: 'building', name: 'Hospital', svg: svgs.hospital }, { id: 3, type: 'road' }, { id: 4, type: 'building', name: 'Banco', svg: svgs.banco },
            { id: 5, type: 'road' }, { id: 6, type: 'road' }, { id: 7, type: 'road' }, { id: 8, type: 'road' }, { id: 9, type: 'road' },
            { id: 10, type: 'building', name: 'Escuela', svg: svgs.escuela }, { id: 11, type: 'road' }, { id: 12, type: 'building', name: 'Plaza', svg: svgs.plaza }, { id: 13, type: 'road' }, { id: 14, type: 'building', name: 'Súper', svg: svgs.super },
            { id: 15, type: 'road' }, { id: 16, type: 'road' }, { id: 17, type: 'road' }, { id: 18, type: 'road' }, { id: 19, type: 'road' },
            { id: 20, type: 'building', name: 'Cine', svg: svgs.cine }, { id: 21, type: 'road' }, { id: 22, type: 'building', name: 'Estación', svg: svgs.estacion }, { id: 23, type: 'road' }, { id: 24, type: 'building', name: 'Biblioteca', svg: svgs.biblioteca }
        ];

        let playerPos = -1;
        let startPos = -1;
        let targetPos = -1;
        let score = 0;
        let currentMission = null;

        const missions = [
            { 
                start: 22, // Estación
                target: 14, // Súper
                text: "Estás en la <b>Estación</b>. Tienes hambre. ¡Ve al <b>Súper</b>!",
                options: [
                    { text: "Salí de la estación, seguí todo recto y giré a la derecha.", correct: true },
                    { text: "Crucé la plaza y salté sobre el hospital.", correct: false }
                ]
            },
            { 
                start: 12, // Plaza
                target: 4, // Banco
                text: "Estás en la <b>Plaza</b>. Necesitas dinero. ¡Ve al <b>Banco</b>!",
                options: [
                    { text: "Salí de la plaza, giré a la derecha, seguí recto y crucé la calle.", correct: true },
                    { text: "Giré a la izquierda y entré en el museo.", correct: false }
                ]
            },
            { 
                start: 2, // Hospital
                target: 0, // Museo
                text: "Sal del <b>Hospital</b> y visita el <b>Museo</b> de arte.",
                options: [
                    { text: "Salí del hospital, giré a la izquierda y el museo estaba al lado.", correct: true },
                    { text: "Seguí recto hacia la biblioteca.", correct: false }
                ]
            },
            { 
                start: 20, // Cine
                target: 10, // Escuela
                text: "Estás en el <b>Cine</b>. ¡Rápido! Tienes clase en la <b>Escuela</b>.",
                options: [
                    { text: "Salí del cine, seguí todo recto y la escuela está a la izquierda.", correct: true },
                    { text: "Crucé la plaza y giré a la derecha.", correct: false }
                ]
            }
        ];

        function renderMap() {
            const container = document.getElementById('city-map');
            container.innerHTML = '';
            
            // Identificar salidas adyacentes al edificio de inicio
            const exits = [startPos-5, startPos+5, startPos-1, startPos+1].filter(id => id>=0 && id<25 && cityData[id].type === 'road');

            cityData.forEach(tile => {
                const div = document.createElement('div');
                let classes = `tile ${tile.type}`;
                if (tile.id === playerPos) classes += ' player';
                if (tile.id === startPos) classes += ' start-point';
                if (tile.id === targetPos) classes += ' target-glow';
                if (exits.includes(tile.id) && playerPos === startPos) classes += ' exit-door';
                
                div.className = classes;
                if (tile.type === 'building') {
                    const status = (tile.id === targetPos) ? '<span class="status-tag bg-sky-500 text-white">Destino</span>' : (tile.id === startPos ? '<span class="status-tag bg-amber-500 text-white">Inicio</span>' : '<span class="status-tag bg-slate-200 text-slate-500">Cerrado</span>');
                    div.innerHTML = `${tile.svg} <span class="font-bold text-slate-800 text-[10px]">${tile.name}</span> ${status}`;
                }
                container.appendChild(div);
            });
        }

        function movePlayer(dir) {
            if (!document.getElementById('validation-panel').classList.contains('hidden-panel')) return;
            
            let next = playerPos;
            const error = document.getElementById('error-msg');
            error.innerText = "";

            if (dir === 'up' && playerPos >= 5) next -= 5;
            else if (dir === 'down' && playerPos <= 19) next += 5;
            else if (dir === 'left' && playerPos % 5 !== 0) next -= 1;
            else if (dir === 'right' && (playerPos + 1) % 5 !== 0) next += 1;
            else if (dir === 'cross') {
                if (playerPos >= 10) next -= 5;
                else if (playerPos <= 14) next += 5;
            }

            // REGLAS:
            // 1. Si está en edificio de inicio, puede salir a la calle.
            // 2. Si está en calle, puede moverse a calle O entrar en el objetivo.
            if (cityData[next].type === 'road' || next === targetPos) {
                playerPos = next;
            } else {
                error.innerText = "? Bloqueado. ¡Usa la calle!";
            }
            renderMap();
        }

        function newMission() {
            currentMission = missions[Math.floor(Math.random() * missions.length)];
            startPos = currentMission.start;
            targetPos = currentMission.target;
            playerPos = startPos; // El jugador empieza ADENTRO

            document.getElementById('mission-text').innerHTML = currentMission.text;
            document.getElementById('start-node-name').innerText = cityData[startPos].name;
            renderMap();
        }

        function checkArrival() {
            if (playerPos === targetPos) {
                showValidation();
            } else {
                document.getElementById('error-msg').innerText = "? Debes entrar en el edificio azul para llegar.";
            }
        }

        function showValidation() {
            document.getElementById('navigation-panel').classList.add('hidden-panel');
            document.getElementById('validation-panel').classList.remove('hidden-panel');
            const optionsDiv = document.getElementById('answer-options');
            optionsDiv.innerHTML = '';
            
            currentMission.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerHTML = `<span>${opt.text}</span>`;
                btn.onclick = () => {
                    if (opt.correct) {
                        score += 10;
                        document.getElementById('score').innerText = score;
                        document.getElementById('validation-panel').classList.add('hidden-panel');
                        document.getElementById('navigation-panel').classList.remove('hidden-panel');
                        newMission();
                    } else {
                        btn.classList.add('border-rose-400', 'bg-rose-50');
                        alert("? No es correcto. Mira el mapa.");
                    }
                };
                optionsDiv.appendChild(btn);
            });
        }

        window.onload = () => newMission();

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') movePlayer('up');
            if (e.key === 'ArrowDown') movePlayer('down');
            if (e.key === 'ArrowLeft') movePlayer('left');
            if (e.key === 'ArrowRight') movePlayer('right');
            if (e.key === 'Enter') checkArrival();
        });
    </script>
</body>
</html>






