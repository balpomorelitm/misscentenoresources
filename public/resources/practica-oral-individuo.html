<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador oral: El Individuo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        @media print { .no-print { display: none; } }
        @keyframes pulse-red { 0%, 100% { background-color: #ef4444; } 50% { background-color: #b91c1c; } }
        .recording-active { animation: pulse-red 1.5s infinite; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-12">
<div style="position:fixed;top:20px;left:20px;z-index:9999" class="no-print"><a href="../index.html" style="display:inline-flex;align-items:center;gap:8px;padding:10px 16px;background:#6366f1;color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.15);transition:all 0.2s" onmouseover="this.style.background='#4f46e5'" onmouseout="this.style.background='#6366f1'"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Resources</a></div>

    

    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8 no-print">
            <h1 class="text-3xl font-bold text-slate-800">Práctica de Examen Oral: curso inicial</h1>
            <p class="text-slate-600 mt-2 font-medium">Bloque temático: El Individuo</p>
            <div class="mt-4 flex justify-center gap-4">
                <button onclick="window.print()" class="bg-white border border-slate-300 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 transition shadow-sm">
                    🖨️ Imprimir Guía
                </button>
            </div>
        </header>

        <!-- Ficha de Preparación -->
        <section id="prep-section" class="bg-white rounded-xl shadow-sm border border-slate-200 p-8 mb-8">
            <h2 class="text-xl font-semibold text-slate-800 mb-6 flex items-center gap-2">
                <span class="bg-blue-100 text-blue-600 p-1.5 rounded-md">📝</span>
                1. Ficha de Notas Personales (El Individuo)
            </h2>
            <div id="prep-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Preguntas cargadas dinámicamente -->
            </div>
        </section>

        <!-- Modelos de Referencia -->
        <section id="ref-section" class="bg-white rounded-xl shadow-sm border border-slate-200 p-8 mb-8">
            <h2 class="text-xl font-semibold text-slate-800 mb-6 flex items-center gap-2">
                <span class="bg-amber-100 text-amber-600 p-1.5 rounded-md">💡</span>
                2. Modelos de Respuesta (Nivel 7)
            </h2>
            <div id="reference-guide" class="space-y-4"></div>
        </section>

        <!-- Simulador -->
        <section id="sim-section" class="no-print bg-slate-900 rounded-2xl p-8 text-white shadow-2xl relative overflow-hidden min-h-[450px] flex flex-col justify-between">
            <div class="relative z-10 w-full">
                <!-- Progress & Timer -->
                <div class="flex justify-between items-center mb-10">
                    <span id="progress-text" class="bg-slate-800 text-slate-400 px-3 py-1 rounded-full text-xs font-mono uppercase">Pregunta 1 de 11</span>
                    <div id="timer-display" class="text-4xl font-bold font-mono text-indigo-400">30s</div>
                </div>

                <!-- Main Content -->
                <div id="sim-content" class="text-center">
                    <div class="min-h-[140px] flex flex-col items-center justify-center">
                        <h3 id="current-question" class="text-2xl font-semibold leading-relaxed mb-6 px-4">¿Listo para practicar el bloque de "El Individuo"?</h3>
                        
                        <div id="initial-controls">
                            <button onclick="initApp()" class="bg-indigo-600 hover:bg-indigo-700 px-10 py-4 rounded-xl font-bold text-lg transition shadow-xl shadow-indigo-500/20">
                                Empezar Práctica Real
                            </button>
                        </div>

                        <div id="active-controls" class="hidden flex flex-col items-center gap-6 w-full">
                            <button id="record-btn" onclick="toggleRecording()" class="bg-red-600 hover:bg-red-700 px-10 py-4 rounded-xl font-bold transition flex items-center gap-3 shadow-lg shadow-red-500/20">
                                <span id="rec-dot" class="w-3 h-3 bg-white rounded-full"></span>
                                <span id="rec-text">Grabar Respuesta</span>
                            </button>
                        </div>
                    </div>

                    <!-- Individual Feedback Area -->
                    <div id="review-area" class="hidden mt-8 space-y-4 text-left w-full max-w-2xl mx-auto">
                        <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Escucha tu grabación</h4>
                            <audio id="audio-playback" controls class="w-full mb-6 filter invert opacity-80"></audio>

                            <!-- Mini Modelo en el simulador -->
                            <div class="bg-indigo-900/30 rounded-xl p-6 border border-indigo-500/30">
                                <div id="model-answer-content" class="text-sm text-indigo-100 leading-relaxed italic">
                                    <!-- Se carga dinámicamente -->
                                </div>
                            </div>
                        </div>
                        <button onclick="nextQuestion()" class="w-full bg-white text-slate-900 py-3 rounded-lg font-bold hover:bg-slate-100 transition shadow-lg">Siguiente Pregunta ?</button>
                    </div>
                </div>
            </div>

            <!-- Reporte Final UI -->
            <div id="final-report" class="hidden relative z-10 w-full max-w-2xl mx-auto text-left py-4">
                <div class="bg-white rounded-2xl p-8 text-slate-900 shadow-2xl border-t-8 border-indigo-600">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2 text-indigo-700">
                        ¡Sección Completada! 🎉
                    </h2>
                    <p class="text-slate-600 text-sm mb-6 pb-4 border-b">Has practicado las 11 preguntas de <strong>El Individuo</strong>.</p>
                    
                    <div class="bg-slate-50 p-6 rounded-xl mb-6 border border-slate-100 italic text-slate-700 text-sm">
                        "¡Buen trabajo! Has repasado tu identidad, tu familia y tu hogar. Recuerda que para el nivel 7 es fundamental hablar con fluidez y usar adjetivos variados en tus descripciones."
                    </div>

                    <button onclick="location.reload()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 transition">Reiniciar Práctica</button>
                </div>
            </div>

            <!-- BG Pattern -->
            <div class="absolute -bottom-24 -right-24 w-80 h-80 bg-indigo-500/10 rounded-full blur-3xl"></div>
        </section>
    </div>

    <script>
        const questions = [
            { q: "¿De dónde eres? ¿Cuántos años tienes?", model: "Soy de Londres, en el Reino Unido, aunque mi familia es originaria de la India. Actualmente tengo diecisiete años y voy a cumplir dieciocho el próximo mes de mayo." },
            { q: "¿Cuántas personas hay en tu familia? Describe a un miembro.", model: "En mi familia somos cuatro personas: mis padres, mi hermano menor y yo. Mi madre es una persona sumamente paciente y trabajadora; físicamente es delgada y tiene el pelo castaño." },
            { q: "¿Tienes primos o abuelos?", model: "Sí, por supuesto. Tengo tres primos que residen en Madrid, por lo que trato de visitarlos cada verano. También tengo a mis abuelos maternos; son muy activos y cariñosos." },
            { q: "¿Tienes un amigo preferido? ¿Cómo es?", model: "Mi mejor amigo se llama Pablo. Es una persona increíblemente leal y tiene un gran sentido del humor. Nos llevamos genial ya que compartimos la misma pasión por el cine." },
            { q: "¿Vives en una casa o en un piso?", model: "Vivo en un piso moderno que está ubicado muy cerca del centro de la ciudad. Aunque no es excesivamente espacioso, es sumamente luminoso y muy acogedor." },
            { q: "Describe tu casa o piso. ¿Qué cuarto prefieres? ¿Por qué?", model: "Mi hogar cuenta con tres dormitorios amplios y un salón acogedor. Sin duda, mi habitación preferida es mi dormitorio, puesto que es mi refugio personal donde puedo estudiar y relajarme." },
            { q: "¿Es mejor vivir en una casa o en un piso? ¿Por qué?", model: "Desde mi punto de vista, es preferible vivir en una casa porque ofrece mayor privacidad y espacio exterior, como un jardín. Sin embargo, un piso suele estar mejor comunicado con el centro." },
            { q: "¿Qué haces para ayudar en casa?", model: "Normalmente colaboro con las tareas domésticas, como poner el lavaplatos o sacar la basura a diario. Además, los sábados me encargo de limpiar mi habitación y organizar mis libros." },
            { q: "¿Qué has hecho con tu familia el fin de semana?", model: "Este último fin de semana hemos ido a un restaurante típico para celebrar el cumpleaños de mi padre. Después, dimos un paseo largo por el parque local porque hacía un tiempo espléndido." },
            { q: "¿Cómo sería tu casa ideal?", model: "Mi casa ideal sería una villa de estilo moderno situada frente al mar. Tendría una cocina enorme equipada, una piscina infinita y grandes ventanales para poder apreciar el atardecer." },
            { q: "¿Dónde vives exactamente?", model: "Vivo exactamente en un barrio residencial muy tranquilo llamado Chelsea, en el suroeste de Londres. Es una zona pintoresca, situada a pocos minutos de la estación de metro principal." }
        ];

        let currentIdx = 0;
        let timer, timeLeft = 30;
        let mediaRecorder, chunks = [];
        let isRecording = false;
        let userStream = null;

        // 1. Initial Render
        const prepList = document.getElementById('prep-list');
        const refGuide = document.getElementById('reference-guide');
        questions.forEach((q, i) => {
            prepList.innerHTML += `<div class="border-b border-slate-100 pb-4"><label class="block text-slate-700 font-semibold mb-2">${i+1}. ${q.q}</label><textarea class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition" placeholder="Vocabulario clave (familia, edad, casa)..."></textarea></div>`;
            refGuide.innerHTML += `<div class="p-4 border border-slate-100 rounded-lg bg-slate-50"><p class="font-bold text-slate-800 text-sm mb-2">${i+1}. ${q.q}</p><p class="text-xs text-slate-600 bg-white p-3 rounded border border-slate-200 border-l-4 border-l-amber-400 italic">${q.model}</p></div>`;
        });

        // 2. Core Functions
        async function initApp() {
            try {
                userStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                document.getElementById('initial-controls').classList.add('hidden');
                document.getElementById('active-controls').classList.remove('hidden');
                loadQuestion();
            } catch (err) { alert("Necesitas permitir el acceso al micrófono para grabar tus respuestas."); }
        }

        function loadQuestion() {
            const q = questions[currentIdx];
            document.getElementById('current-question').innerText = q.q;
            document.getElementById('progress-text').innerText = `Pregunta ${currentIdx + 1} de ${questions.length}`;
            document.getElementById('review-area').classList.add('hidden');
            document.getElementById('active-controls').classList.remove('hidden');
            resetTimer();
        }

        function resetTimer() {
            clearInterval(timer); timeLeft = 30; updateTimerUI();
            timer = setInterval(() => { 
                timeLeft--; updateTimerUI(); 
                if (timeLeft <= 0) { clearInterval(timer); if(isRecording) toggleRecording(); }
            }, 1000);
        }

        function updateTimerUI() {
            const el = document.getElementById('timer-display');
            el.innerText = timeLeft + "s";
            el.classList.toggle('text-red-500', timeLeft <= 5);
        }

        async function toggleRecording() {
            const btn = document.getElementById('record-btn');
            const txt = document.getElementById('rec-text');
            if (!isRecording) {
                mediaRecorder = new MediaRecorder(userStream);
                chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'audio/webm' });
                    document.getElementById('audio-playback').src = URL.createObjectURL(blob);
                    document.getElementById('model-answer-content').innerHTML = `<strong>Modelo Sugerido:</strong><br>${questions[currentIdx].model}`;
                    document.getElementById('review-area').classList.remove('hidden');
                    document.getElementById('active-controls').classList.add('hidden');
                };
                mediaRecorder.start(); isRecording = true;
                btn.classList.add('recording-active'); txt.innerText = "Detener Grabación";
            } else {
                mediaRecorder.stop(); isRecording = false;
                btn.classList.remove('recording-active'); txt.innerText = "Grabar Respuesta";
                clearInterval(timer);
            }
        }

        function nextQuestion() {
            if (currentIdx < questions.length - 1) { currentIdx++; loadQuestion(); } 
            else { showFinalReport(); }
        }

        function showFinalReport() {
            document.getElementById('sim-content').classList.add('hidden');
            document.getElementById('timer-display').classList.add('hidden');
            document.getElementById('progress-text').innerText = "Simulacro Finalizado";
            document.getElementById('final-report').classList.remove('hidden');
        }
    </script>
</body>
</html>







